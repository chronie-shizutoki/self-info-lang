<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self Info - Language Selection</title>
    <meta name="description" content="Choose your preferred language for Self Info website">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div class="glass-container">
        <h1>Language Choose</h1>
        
        <!-- Language-specific text containers -->
        <div id="language-text" class="language-text">
            <p class="lang-en">If this is not your preferred language, please select your desired language from the top-right</p>
            <p class="lang-ja">これがあなたの希望する言語でない場合は、右上から希望の言語を選択してください</p>
            <p class="lang-zh-CN">如果这不是你希望的语言，请从右上角选择你希望的语言</p>
            <p class="lang-zh-Hans">如果这不是你希望的语言，请从右上角选择你希望的语言</p>
            <p class="lang-zh-TW">如果這不是你希望的語言，請從右上角選擇你希望的語言</p>
        </div>
        
        <!-- Language recommendations container -->
        <div id="language-recommendation" class="language-recommendation glass-container">
            <h3 class="lang-en">Recommended Language:</h3>
            <h3 class="lang-ja hidden">推奨される言語：</h3>
            <h3 class="lang-zh-CN hidden">推荐语言：</h3>
            <h3 class="lang-zh-Hans hidden">推荐语言：</h3>
            <h3 class="lang-zh-TW hidden">推薦語言：</h3>
            <div id="recommended-langs"></div>
        </div>
    </div>
    
    <!-- Feedback button with language-specific text -->
    <button id="feedback-button" class="feedback-button">
        <i class="fas fa-comment-dots"></i>
        <span class="feedback-text lang-en">Feedback</span>
        <span class="feedback-text lang-ja hidden">フィードバック</span>
        <span class="feedback-text lang-zh-CN hidden">反馈</span>
        <span class="feedback-text lang-zh-Hans hidden">反馈</span>
        <span class="feedback-text lang-zh-TW hidden">回饋</span>
    </button>

    <!-- Changelog button with language-specific text -->
    <button id="changelog-button" class="changelog-button">
        <i class="fas fa-history"></i>
        <span class="changelog-text lang-en">Changelog</span>
        <span class="changelog-text lang-ja hidden">更新履歴</span>
        <span class="changelog-text lang-zh-CN hidden">更新记录</span>
        <span class="changelog-text lang-zh-TW hidden">更新記錄</span>
    </button>
    
    <script>
        // Add event listener to feedback button
        document.getElementById('feedback-button').addEventListener('click', function() {
            window.open('https://jyskyp4y.forms.app/untitled-form', '_blank');
        });

        // Add event listener to changelog button
        document.getElementById('changelog-button').addEventListener('click', function() {
            window.open('https://changelog-viewer.netlify.app/', '_blank');
        });
        
        // Function to update button text based on current language
        function updateButtonText(languageCode) {
            // Hide all language-specific text
            document.querySelectorAll('.feedback-text, .changelog-text').forEach(el => {
                el.classList.remove('active');
            });
            
            // Show text for the detected language
            const feedbackElements = document.querySelectorAll(`.feedback-text.lang-${languageCode}`);
            const changelogElements = document.querySelectorAll(`.changelog-text.lang-${languageCode}`);
            
            if (feedbackElements.length > 0) {
                feedbackElements.forEach(el => el.classList.add('active'));
            } else {
                // Fallback to English if the language code isn't found
                document.querySelectorAll('.feedback-text.lang-en').forEach(el => el.classList.add('active'));
            }
            
            if (changelogElements.length > 0) {
                changelogElements.forEach(el => el.classList.add('active'));
            } else {
                // Fallback to English if the language code isn't found
                document.querySelectorAll('.changelog-text.lang-en').forEach(el => el.classList.add('active'));
            }
        }
        
        // Rename function for backward compatibility
        function updateFeedbackButton(languageCode) {
            updateButtonText(languageCode);
        }
    </script>
    
    <script src="lang.js"></script>
    
    <!-- Global debug function for switching language via console -->
    <script>
        // Make this function available in global scope
        function switchLanguage(languageCode) {
            // Language data with names and external links
            const languages = [
                { code: 'en', name: 'English', localName: 'English', link: 'https://chronie-shizutoki.github.io/self-info-en' },
                { code: 'ja', name: '日本語', localName: 'Japanese', link: 'https://self-info-ja.netlify.app/' },
                { code: 'zh-Hans', name: '华文', localName: 'Simplified Chinese (SEA)', link: 'https://self-info-zh-hans.netlify.app/' },
                { code: 'zh-TW', name: '繁體中文（台灣）', localName: 'Traditional Chinese (Taiwan)', link: 'https://chronie-shizutoki.github.io/self-info-zh-tw/' },
            ];
            
            // Show only the text for the specified language
            function showLanguageText(languageCode) {
                // Hide all language-specific text
                document.querySelectorAll('.language-text p').forEach(el => {
                    el.classList.remove('active');
                });
                
                // Hide all language-specific headings
                document.querySelectorAll('#language-recommendation h3').forEach(el => {
                    el.classList.add('hidden');
                });
                
                // Show text for the detected language
                const langElement = document.querySelector(`.lang-${languageCode}`);
                if (langElement) {
                    document.querySelectorAll(`.lang-${languageCode}`).forEach(el => {
                        el.classList.add('active');
                        el.classList.remove('hidden');
                    });
                } else {
                    // Fallback to English if the language code isn't found
                    document.querySelectorAll('.lang-en').forEach(el => {
                        el.classList.add('active');
                        el.classList.remove('hidden');
                    });
                    console.warn(`Language code '${languageCode}' not found. Falling back to English.`);
                    return 'en';
                }
                return languageCode;
            }
            
            // Update button text based on current language
            function updateFeedbackButton(languageCode) {
                // Hide all language-specific text
                document.querySelectorAll('.feedback-text, .changelog-text').forEach(el => {
                    el.classList.remove('active');
                });
                
                // Show text for the detected language
                const feedbackElements = document.querySelectorAll(`.feedback-text.lang-${languageCode}`);
                const changelogElements = document.querySelectorAll(`.changelog-text.lang-${languageCode}`);
                
                if (feedbackElements.length > 0) {
                    feedbackElements.forEach(el => el.classList.add('active'));
                } else {
                    // Fallback to English if the language code isn't found
                    document.querySelectorAll('.feedback-text.lang-en').forEach(el => el.classList.add('active'));
                }
                
                if (changelogElements.length > 0) {
                    changelogElements.forEach(el => el.classList.add('active'));
                } else {
                    // Fallback to English if the language code isn't found
                    document.querySelectorAll('.changelog-text.lang-en').forEach(el => el.classList.add('active'));
                }
            }
            
            // Find matching language
            function getRecommendedLanguages(languageCode) {
                const recommendations = [];
                
                // Check for exact match
                const exactMatch = languages.find(lang => lang.code === languageCode);
                if (exactMatch) {
                    recommendations.push(exactMatch);
                }
                
                // Add other languages for reference
                const otherLangs = languages.filter(lang => lang.code !== languageCode);
                recommendations.push(...otherLangs.slice(0, 3)); // Add up to 3 more languages
                
                return recommendations;
            }
            
            // Display language recommendations
            function displayRecommendations(recommendedLangs) {
                const container = document.getElementById('language-recommendation');
                const langsContainer = document.getElementById('recommended-langs');
                
                // Clear previous recommendations
                langsContainer.innerHTML = '';
                
                // Add recommended language links
                recommendedLangs.forEach(lang => {
                    const link = document.createElement('a');
                    link.href = lang.link;
                    link.target = '_blank';
                    link.className = 'recommended-lang';
                    link.textContent = lang.name;
                    
                    langsContainer.appendChild(link);
                });
                
                // Show the container
                container.style.display = 'block';
            }
            
            // Validate language code
            if (!languageCode || typeof languageCode !== 'string') {
                console.error('Please provide a valid language code, e.g., switchLanguage("en")');
                console.log('Available language codes:', languages.map(lang => lang.code).join(', '));
                return;
            }
            
            // Switch to the specified language
            const actualLanguage = showLanguageText(languageCode);
            updateFeedbackButton(actualLanguage);
            
            // Display recommendations including the selected language
            const recommendedLangs = getRecommendedLanguages(actualLanguage);
            displayRecommendations(recommendedLangs);
            
            // Show success message in console
            const langName = languages.find(lang => lang.code === actualLanguage)?.name || 'English';
            console.log(`Switched to ${langName} (${actualLanguage})`);
            console.log('To switch language again, use: switchLanguage("code") where code is one of:', languages.map(lang => lang.code).join(', '));
        };
        
        // Show console message with usage instructions
        console.log('Language Debug Tool');
        console.log('Switch languages using: switchLanguage("code")');
        console.log('Available codes: en, ja, zh-Hans, zh-TW');
        console.log('Example: switchLanguage("ja")');
    </script>
    
    <script>
        /**
         * Main application script that works with the LanguageSelector class
         */
        document.addEventListener('DOMContentLoaded', async () => {
            // Language data with names and external links
            const languages = [
                { code: 'en', name: 'English', localName: 'English', link: 'https://chronie-shizutoki.github.io/self-info-en' },
                { code: 'ja', name: '日本語', localName: 'Japanese', link: 'https://self-info-ja.netlify.app/' },
                { code: 'zh-Hans', name: '华文', localName: 'Simplified Chinese (SEA)', link: 'https://self-info-zh-hans.netlify.app/' },
                { code: 'zh-TW', name: '繁體中文（台灣）', localName: 'Traditional Chinese (Taiwan)', link: 'https://chronie-shizutoki.github.io/self-info-zh-tw/' },
            ];
            
            // Show only the text for the detected language
            function showLanguageText(languageCode) {
                // Hide all language-specific text
                document.querySelectorAll('.language-text p').forEach(el => {
                    el.classList.remove('active');
                });
                
                // Hide all language-specific headings
                document.querySelectorAll('#language-recommendation h3').forEach(el => {
                    el.classList.add('hidden');
                });
                
                // Show text for the detected language
                const langElement = document.querySelector(`.lang-${languageCode}`);
                if (langElement) {
                    document.querySelectorAll(`.lang-${languageCode}`).forEach(el => {
                        el.classList.add('active');
                        el.classList.remove('hidden');
                    });
                } else {
                    // Fallback to English if the language code isn't found
                    document.querySelectorAll('.lang-en').forEach(el => {
                        el.classList.add('active');
                        el.classList.remove('hidden');
                    });
                }
            }
            
            // Get user's browser language
            function getUserBrowserLanguage() {
                // Get the browser's language preference
                return navigator.language || navigator.userLanguage; // Return full language code (e.g., 'en-US')
            }
            
            // Find matching language or fallback based on new logic
            function getRecommendedLanguages(browserLang) {
                const recommendations = [];
                
                // Priority 2: Handle Chinese language variants
                if (browserLang.toLowerCase().startsWith('zh-')) {
                    const lowerCaseBrowserLang = browserLang.toLowerCase();
                    
                    // Traditional Chinese variants (Hong Kong, Macau, Taiwan)
                    const traditionalVariants = ['zh-hk', 'zh-mo', 'zh-tw'];
                    const isTraditionalVariant = traditionalVariants.some(variant => 
                        lowerCaseBrowserLang === variant || lowerCaseBrowserLang.startsWith(variant + '-')
                    );
                    
                    if (isTraditionalVariant) {
                        // Use Traditional Chinese (Taiwan)
                        const zhTWLang = languages.find(lang => lang.code === 'zh-TW');
                        if (zhTWLang) recommendations.push(zhTWLang);
                    } else {
                        // For other Chinese variants (zh-sg, zh-my, etc.), use Simplified Chinese (SEA)
                        const zhHansLang = languages.find(lang => lang.code === 'zh-Hans');
                        if (zhHansLang) recommendations.push(zhHansLang);
                    }
                    
                    return recommendations;
                }
                
                // Priority 3: Check for exact language match
                const exactMatch = languages.find(lang => 
                    lang.code === browserLang || 
                    lang.code.startsWith(browserLang.split('-')[0])
                );
                if (exactMatch) {
                    recommendations.push(exactMatch);
                }
                
                // Priority 4: If no match, add Japanese and English as fallbacks
                if (recommendations.length === 0) {
                    const japanese = languages.find(lang => lang.code === 'ja');
                    const english = languages.find(lang => lang.code === 'en');
                    
                    if (japanese) recommendations.push(japanese);
                    if (english) recommendations.push(english);
                }
                
                return recommendations;
            }
            
            // Display language recommendations
            function displayRecommendations(recommendedLangs) {
                const container = document.getElementById('language-recommendation');
                const langsContainer = document.getElementById('recommended-langs');
                
                // Clear previous recommendations
                langsContainer.innerHTML = '';
                
                // Add recommended language links (max 4 languages)
                const displayLangs = recommendedLangs.slice(0, 4);
                displayLangs.forEach(lang => {
                    const link = document.createElement('a');
                    link.href = lang.link;
                    link.target = '_blank';
                    link.className = 'recommended-lang';
                    link.textContent = lang.name;
                    
                    langsContainer.appendChild(link);
                });
                
                // Show the container
                container.style.display = 'block';
            }
            
            // Main function to handle language recommendation and location check
            async function handleLanguageSelection() {
                const browserLang = getUserBrowserLanguage();
                
                console.log('Browser language:', browserLang);
                
                    // Use browser language detection
                    const recommendedLangs = getRecommendedLanguages(browserLang);
                    
                    // Determine the display language based on recommendations
                    let detectedLanguage = 'en'; // Default to English
                    
                    if (recommendedLangs.length > 0) {
                        detectedLanguage = recommendedLangs[0].code;
                    }
                    
                    showLanguageText(detectedLanguage);
                    updateFeedbackButton(detectedLanguage);
                    displayRecommendations(recommendedLangs);
                    
                    console.log(`Detected language: ${detectedLanguage}`);
                }
            
            // Initialize the language selection
            await handleLanguageSelection();
        });
    </script>
</body>
</html>
