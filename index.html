<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self Info - Language Choose</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #ec4899;
            --text-color: #ffffff;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui , sans-serif;
        }
        
        body {
            background: url('background.jpg') no-repeat center 20%;
            background-size: cover;
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .glass-container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px) saturate(180%);
            -webkit-backdrop-filter: blur(10px) saturate(180%);
            border-radius: 24px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
            padding: 40px;
            max-width: 800px;
            width: 100%;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .glass-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.45);
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, #ffffff, #e2e8f0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        p {
            font-size: 1rem;
            margin-bottom: 30px;
            line-height: 1;
        }
        
        .language-recommendation {
            margin: 30px 0;
            padding: 20px;
            border-radius: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .language-recommendation h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .recommended-lang {
            display: inline-block;
            margin: 10px;
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .recommended-lang:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--accent-color);
        }
        
        .feature-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        footer {
            margin-top: 40px;
            padding: 20px;
            text-align: center;
            opacity: 0.8;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .glass-container {
                padding: 30px 20px;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
        }
        
        /* Animation for floating elements */
        @keyframes float {
            0% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
            100% {
                transform: translateY(0px);
            }
        }
        
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        .float-animation:nth-child(2) {
            animation-delay: 1s;
        }
        
        .float-animation:nth-child(3) {
            animation-delay: 2s;
        }
    </style>
</head>
<body>
    <div class="glass-container">
        <h1>Self Info - Language Choose</h1>
        <!-- Language-specific text containers -->
        <div id="language-text" class="language-text">
            <p class="lang-en">If this is not your preferred language, please select your desired language from the top-right</p>
            <p class="lang-ja">これがあなたの希望する言語でない場合は、右上から希望の言語を選択してください</p>
            <p class="lang-zh-CN">如果这不是你希望的语言，请从右上角选择你希望的语言</p>
            <p class="lang-zh-TW">如果這不是你希望的語言，請從右上角選擇你希望的語言</p>
        </div>
        
        <!-- This will be populated by the script with language recommendations -->
        <div id="language-recommendation" class="language-recommendation">
            <h3 class="lang-en">Recommended Language:</h3>
            <h3 class="lang-ja hidden">推奨される言語：</h3>
            <h3 class="lang-zh-CN hidden">推荐语言：</h3>
            <h3 class="lang-zh-TW hidden">推薦語言：</h3>
            <div id="recommended-langs"></div>
        </div>

    <div id="character-info">
        <p class="lang-ja">月に寄りそう乙女の作法  ルナちょむ Pixiv ID | 133337546</p>
        <p class="lang-zh-CN">近月少女的礼仪  樱小路露娜 Pixiv ID | 133337546</p>
        <p class="lang-zh-TW">近月少女的禮儀  櫻小路露娜 Pixiv ID | 133337546</p>
        <p class="lang-en">The Principle of Having an Elegance in the Moon  Luna Sakuragi Pixiv ID | 133337546</p>
    </div>
    
    <style>
        .language-text p,
        #character-info p {
            display: none;
        }
        
        .language-text p.active,
        #character-info p.active {
            display: block;
        }
        
        .hidden {
            display: none;
        }
    </style>

    
    <!-- Feedback button with language-specific text -->
    <button id="feedback-button" class="feedback-button">
        <i class="fas fa-comment-dots"></i>
        <span class="feedback-text lang-en">Feedback</span>
        <span class="feedback-text lang-ja hidden">フィードバック</span>
        <span class="feedback-text lang-zh-CN hidden">反馈</span>
        <span class="feedback-text lang-zh-TW hidden">回饋</span>
    </button>
    
    <style>
        /* Feedback button styles */
        .feedback-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            font-family: system-ui, sans-serif;
            font-size: 16px;
            cursor: pointer;
            z-index: 999;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feedback-button:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateX(-50%) translateY(-3px);
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.2);
        }
        
        /* Feedback text styles */
        .feedback-text {
            display: none;
        }
        
        .feedback-text.active {
            display: inline;
        }
        
        /* Responsive styles for feedback button */
        @media (max-width: 600px) {
            .feedback-button {
                padding: 10px 20px;
                font-size: 14px;
                bottom: 15px;
            }
        }
    </style>
    
    <script>
        // Add event listener to feedback button
        document.getElementById('feedback-button').addEventListener('click', function() {
            window.open('https://jyskyp4y.forms.app/untitled-form', '_blank');
        });
        
        // Function to update feedback button text based on current language
        function updateFeedbackButton(languageCode) {
            // Hide all language-specific text
            document.querySelectorAll('.feedback-text').forEach(el => {
                el.classList.remove('active');
            });
            
            // Show text for the detected language
            const langElement = document.querySelector(`.feedback-text.lang-${languageCode}`);
            if (langElement) {
                langElement.classList.add('active');
            } else {
                // Fallback to English if the language code isn't found
                document.querySelector('.feedback-text.lang-en').classList.add('active');
            }
        }
    </script>
    
    <script src="lang.js"></script>
    <!-- Global debug function for switching language via console -->
    <script>
        // Make this function available in global scope
        function switchLanguage(languageCode) {
            // Language data with names and external links
            const languages = [
                { code: 'en', name: 'English', localName: 'English', link: 'https://chronie-shizutoki.github.io/self-info-en' },
                { code: 'ja', name: '日本語', localName: 'Japanese', link: 'https://self-info-ja.netlify.app/' },
                { code: 'zh-CN', name: '简体中文（中国大陆）', localName: 'Simplified Chinese (China)', link: 'https://chronie-shizutoki-self-info-zh-cn.netlify.app/' },
                { code: 'zh-MY', name: '华文（马来西亚）', localName: 'Chinese (Malaysia)', link: 'https://chronie-shizutoki.github.io/self-info-zh-my/' },
                { code: 'zh-SG', name: '华文（新加坡）', localName: 'Chinese (Singapore)', link: 'https://chronie-shizutoki.github.io/self-info-zh-sg/' },
                { code: 'zh-TW', name: '繁體中文（台灣）', localName: 'Traditional Chinese (Taiwan)', link: 'https://chronie-shizutoki.github.io/self-info-zh-tw/' },
            ];
            
            // Show only the text for the specified language
            function showLanguageText(languageCode) {
                // Hide all language-specific text
                document.querySelectorAll('.language-text p, #character-info p').forEach(el => {
                    el.classList.remove('active');
                });
                
                // Hide all language-specific headings
                document.querySelectorAll('#language-recommendation h3').forEach(el => {
                    el.classList.add('hidden');
                });
                
                // Show text for the detected language
                const langElement = document.querySelector(`.lang-${languageCode}`);
                if (langElement) {
                    document.querySelectorAll(`.lang-${languageCode}`).forEach(el => {
                        el.classList.add('active');
                    });
                } else {
                    // Fallback to English if the language code isn't found
                    document.querySelectorAll('.lang-en').forEach(el => {
                        el.classList.add('active');
                    });
                    console.warn(`Language code '${languageCode}' not found. Falling back to English.`);
                    return 'en';
                }
                return languageCode;
            }
            
            // Update feedback button text based on current language
            function updateFeedbackButton(languageCode) {
                // Hide all language-specific text
                document.querySelectorAll('.feedback-text').forEach(el => {
                    el.classList.remove('active');
                });
                
                // Show text for the detected language
                const langElement = document.querySelector(`.feedback-text.lang-${languageCode}`);
                if (langElement) {
                    langElement.classList.add('active');
                } else {
                    // Fallback to English if the language code isn't found
                    document.querySelector('.feedback-text.lang-en').classList.add('active');
                }
            }
            
            // Find matching language
            function getRecommendedLanguages(languageCode) {
                const recommendations = [];
                
                // Check for exact match
                const exactMatch = languages.find(lang => lang.code === languageCode);
                if (exactMatch) {
                    recommendations.push(exactMatch);
                }
                
                // Add other languages for reference
                const otherLangs = languages.filter(lang => lang.code !== languageCode);
                recommendations.push(...otherLangs.slice(0, 3)); // Add up to 3 more languages
                
                return recommendations;
            }
            
            // Display language recommendations
            function displayRecommendations(recommendedLangs) {
                const container = document.getElementById('language-recommendation');
                const langsContainer = document.getElementById('recommended-langs');
                
                // Clear previous recommendations
                langsContainer.innerHTML = '';
                
                // Add recommended language links
                recommendedLangs.forEach(lang => {
                    const link = document.createElement('a');
                    link.href = lang.link;
                    link.target = '_blank';
                    link.className = 'recommended-lang';
                    link.textContent = lang.name;
                    
                    // Add hover effect
                    link.addEventListener('mouseenter', () => {
                        link.style.background = 'rgba(255, 255, 255, 0.25)';
                        link.style.transform = 'translateY(-3px)';
                        link.style.boxShadow = '0 6px 20px rgba(0, 0, 0, 0.15)';
                    });
                    
                    link.addEventListener('mouseleave', () => {
                        link.style.background = 'rgba(255, 255, 255, 0.15)';
                        link.style.transform = 'translateY(0)';
                        link.style.boxShadow = 'none';
                    });
                    
                    langsContainer.appendChild(link);
                });
                
                // Show the container with fade-in animation
                container.style.opacity = '0';
                container.style.transform = 'translateY(20px)';
                container.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                
                // Trigger animation after a small delay
                setTimeout(() => {
                    container.style.opacity = '1';
                    container.style.transform = 'translateY(0)';
                }, 100);
            }
            
            // Validate language code
            if (!languageCode || typeof languageCode !== 'string') {
                console.error('Please provide a valid language code, e.g., switchLanguage("en")');
                console.log('Available language codes:', languages.map(lang => lang.code).join(', '));
                return;
            }
            
            // Switch to the specified language
            const actualLanguage = showLanguageText(languageCode);
            updateFeedbackButton(actualLanguage);
            
            // Display recommendations including the selected language
            const recommendedLangs = getRecommendedLanguages(actualLanguage);
            displayRecommendations(recommendedLangs);
            
            // Show success message in console
            const langName = languages.find(lang => lang.code === actualLanguage)?.name || 'English';
            console.log(`Switched to ${langName} (${actualLanguage})`);
            console.log('To switch language again, use: switchLanguage("code") where code is one of:', languages.map(lang => lang.code).join(', '));
        };
        
        // Show console message with usage instructions
        console.log('%c🔤 Language Debug Tool', 'font-weight: bold; color: #6366f1;');
        console.log('Switch languages using: switchLanguage("code")');
        console.log('Available codes: en, ja, zh-CN, zh-MY, zh-SG, zh-TW');
        console.log('Example: switchLanguage("zh-CN")');
        
    </script>
    <script>
        /**
         * Main application script that works with the LanguageSelector class
         */
        document.addEventListener('DOMContentLoaded', async () => {
            // Language data with names and external links
            const languages = [
                { code: 'en', name: 'English', localName: 'English', link: 'https://chronie-shizutoki.github.io/self-info-en' },
                { code: 'ja', name: '日本語', localName: 'Japanese', link: 'https://self-info-ja.netlify.app/' },
                { code: 'zh-CN', name: '简体中文（中国大陆）', localName: 'Simplified Chinese (China)', link: 'https://chronie-shizutoki-self-info-zh-cn.netlify.app/' },
                { code: 'zh-MY', name: '华文（马来西亚）', localName: 'Chinese (Malaysia)', link: 'https://chronie-shizutoki.github.io/self-info-zh-my/' },
                { code: 'zh-SG', name: '华文（新加坡）', localName: 'Chinese (Singapore)', link: 'https://chronie-shizutoki.github.io/self-info-zh-sg/' },
                { code: 'zh-TW', name: '繁體中文（台灣）', localName: 'Traditional Chinese (Taiwan)', link: 'https://chronie-shizutoki.github.io/self-info-zh-tw/' },
            ];
            
            // Show only the text for the detected language
            function showLanguageText(languageCode) {
                // Hide all language-specific text
                document.querySelectorAll('.language-text p, #character-info p').forEach(el => {
                    el.classList.remove('active');
                });
                
                // Hide all language-specific headings
                document.querySelectorAll('#language-recommendation h3').forEach(el => {
                    el.classList.add('hidden');
                });
                
                // Show text for the detected language
                const langElement = document.querySelector(`.lang-${languageCode}`);
                if (langElement) {
                    document.querySelectorAll(`.lang-${languageCode}`).forEach(el => {
                        el.classList.add('active');
                    });
                } else {
                    // Fallback to English if the language code isn't found
                    document.querySelectorAll('.lang-en').forEach(el => {
                        el.classList.add('active');
                    });
                }
            }
            
            // Check if user is in mainland China
            async function checkIfInMainlandChina() {
                try {
                    // Using a free IP geolocation API
                    const response = await fetch('https://ipapi.co/json/');
                    const data = await response.json();
                    
                    // If country is China and region is not Hong Kong or Macau
                    if (data.country_code === 'CN' && data.region !== '91' && data.region !== '92') {
                        return true;
                    }
                    return false;
                } catch (error) {
                    console.error('Error checking location:', error);
                    return false; // Default to not in China if there's an error
                }
            }
            
            // Get user's browser language
            function getUserBrowserLanguage() {
                // Get the browser's language preference
                const browserLang = navigator.language || navigator.userLanguage;
                return browserLang; // Return full language code (e.g., 'en-US')
            }
            
            // Find matching language or fallback to Japanese/English
            function getRecommendedLanguages(browserLang) {
                const recommendations = [];
                
                // 特殊处理中文语言代码
                // If the browser language starts with 'zh-' but is not 'zh-tw', 'zh-hk' or 'zh-mo', use Simplified Chinese
                if (browserLang.toLowerCase().startsWith('zh-')) {
                    const zhVariants = ['zh-tw', 'zh-hk', 'zh-mo'];
                    const lowerCaseBrowserLang = browserLang.toLowerCase();
                    
                    // 检查是否是繁体中文变体
                    const isTraditionalVariant = zhVariants.some(variant => 
                        lowerCaseBrowserLang === variant || lowerCaseBrowserLang.startsWith(variant + '-')
                    );
                    
                    if (isTraditionalVariant) {
                        // 使用繁体中文
                        const zhTWLang = languages.find(lang => lang.code === 'zh-TW');
                        if (zhTWLang) recommendations.push(zhTWLang);
                    } else {
                        // 其他所有中文变体都使用简体中文
                        const zhCNLang = languages.find(lang => lang.code === 'zh-CN');
                        if (zhCNLang) recommendations.push(zhCNLang);
                    }
                    
                    return recommendations;
                }
                
                // Check for exact match
                const exactMatch = languages.find(lang => lang.code === browserLang || lang.code.startsWith(browserLang + '-'));
                if (exactMatch) {
                    recommendations.push(exactMatch);
                }
                
                // If no exact match, add Japanese and English as fallbacks
                if (recommendations.length === 0) {
                    const japanese = languages.find(lang => lang.code === 'ja');
                    const english = languages.find(lang => lang.code === 'en');
                    
                    if (japanese) recommendations.push(japanese);
                    if (english) recommendations.push(english);
                }
                
                return recommendations;
            }
            
            // Display language recommendations
            function displayRecommendations(recommendedLangs) {
                const container = document.getElementById('language-recommendation');
                const langsContainer = document.getElementById('recommended-langs');
                
                // Clear previous recommendations
                langsContainer.innerHTML = '';
                
                // Add recommended language links (max 4 languages)
                const displayLangs = recommendedLangs.slice(0, 4);
                displayLangs.forEach(lang => {
                    const link = document.createElement('a');
                    link.href = lang.link;
                    link.target = '_blank';
                    link.className = 'recommended-lang';
                    link.textContent = lang.name;
                    
                    // Add hover effect
                    link.addEventListener('mouseenter', () => {
                        link.style.background = 'rgba(255, 255, 255, 0.25)';
                        link.style.transform = 'translateY(-3px)';
                        link.style.boxShadow = '0 6px 20px rgba(0, 0, 0, 0.15)';
                    });
                    
                    link.addEventListener('mouseleave', () => {
                        link.style.background = 'rgba(255, 255, 255, 0.15)';
                        link.style.transform = 'translateY(0)';
                        link.style.boxShadow = 'none';
                    });
                    
                    langsContainer.appendChild(link);
                });
                
                // Show the container with fade-in animation
                container.style.opacity = '0';
                container.style.transform = 'translateY(20px)';
                container.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                
                // Trigger animation after a small delay
                setTimeout(() => {
                    container.style.opacity = '1';
                    container.style.transform = 'translateY(0)';
                }, 100);
            }
            
            // Main function to handle language recommendation and location check
            async function handleLanguageSelection() {
                const isInMainlandChina = await checkIfInMainlandChina();
                
                if (isInMainlandChina) {
                    // User is in mainland China, show simplified Chinese version
                    const zhCNLang = languages.find(lang => lang.code === 'zh-CN');
                    if (zhCNLang) {
                        // Show message and provide the link
                        const container = document.getElementById('language-recommendation');
                        const langsContainer = document.getElementById('recommended-langs');
                        
                        // Update the heading text
                        document.querySelector('.lang-zh-CN.hidden').textContent = '根据您的位置，我们推荐：';
                        
                        // Show Chinese text
                        showLanguageText('zh-CN');
                        updateFeedbackButton('zh-CN');
                        
                        const link = document.createElement('a');
                        link.href = zhCNLang.link;
                        link.target = '_blank';
                        link.className = 'recommended-lang';
                        link.textContent = zhCNLang.name;
                        
                        // Add hover effect
                        link.addEventListener('mouseenter', () => {
                            link.style.background = 'rgba(255, 255, 255, 0.25)';
                            link.style.transform = 'translateY(-3px)';
                            link.style.boxShadow = '0 6px 20px rgba(0, 0, 0, 0.15)';
                        });
                        
                        link.addEventListener('mouseleave', () => {
                            link.style.background = 'rgba(255, 255, 255, 0.15)';
                            link.style.transform = 'translateY(0)';
                            link.style.boxShadow = 'none';
                        });
                        
                        langsContainer.appendChild(link);
                        
                        // Add fade-in animation
                        container.style.opacity = '0';
                        container.style.transform = 'translateY(20px)';
                        container.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                        
                        setTimeout(() => {
                            container.style.opacity = '1';
                            container.style.transform = 'translateY(0)';
                        }, 100);
                    }
                } else {
                    // User is not in mainland China, proceed with normal language detection
                    const browserLang = getUserBrowserLanguage();
                    const recommendedLangs = getRecommendedLanguages(browserLang);
                    
                    // Show text for the most relevant language
            const primaryLang = recommendedLangs[0]?.code || 'en';
            showLanguageText(primaryLang);
            updateFeedbackButton(primaryLang);
                    
                    // Display up to 4 recommended languages
                    displayRecommendations(recommendedLangs);
                }
            }
            
            // Start the language selection process
            try {
                await handleLanguageSelection();
            } catch (error) {
                console.error('Error in language selection:', error);
                // Fallback: show English and Japanese options if there's an error
                const fallbackLangs = [
                    languages.find(lang => lang.code === 'en'),
                    languages.find(lang => lang.code === 'ja')
                ].filter(Boolean);
                
                if (fallbackLangs.length > 0) {
                    // Show English text as fallback
                    showLanguageText('en');
                    updateFeedbackButton('en');
                    displayRecommendations(fallbackLangs);
                }
            }
        });
    </script>
</body>
</html>